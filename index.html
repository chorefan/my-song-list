<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æœ¬æ ¼ã‚ã¿ã ãã˜é¸æ›²</title>
<style>
  body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; background-color: #f4f4f4; text-align: center; }
  .search-container { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
  
  /* ã‚ã¿ã ãã˜ã‚­ãƒ£ãƒ³ãƒã‚¹ */
  #amida-stage { background: white; border-radius: 8px; box-shadow: inset 0 0 10px rgba(0,0,0,0.05); cursor: crosshair; }
  .controls { margin-top: 15px; }
  .btn-start { background: #e91e63; color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold; font-size: 1.1rem; }
  .btn-start:disabled { background: #ccc; }

  table { width: 100%; border-collapse: collapse; background: white; margin-top: 20px; text-align: left; }
  th, td { border: 1px solid #ddd; padding: 10px; }
</style>
</head>
<body>

<h1>ğŸ¤ ã‚ã¿ã ãã˜é¸æ›²ã‚µã‚¤ãƒˆ</h1>

<div class="search-container">
    <canvas id="amida-stage" width="800" height="400"></canvas>
    <div class="controls">
        <button id="startBtn" class="btn-start" onclick="drawAmida()">ğŸ² ã‚ã¿ã ãã˜ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
    </div>
    <div id="result-text" style="font-size: 1.5rem; font-weight: bold; color: #e91e63; margin-top: 15px;"></div>
</div>

<div class="search-container">
    <h2>å…¨æ›²ãƒªã‚¹ãƒˆ</h2>
    <table id="songTable"></table>
</div>

<script>
const songs = [
  {title:"é’ã„çŠç‘šç¤", artist:"æ¾ç”°è–å­"},
  {title:"æ „å…‰ã®æ¶æ©‹", artist:"ã‚†ãš"},
  {title:"å¤œã«é§†ã‘ã‚‹", artist:"YOASOBI"},
  {title:"ä¸–ç•Œã«ä¸€ã¤ã ã‘ã®èŠ±", artist:"SMAP"},
  {title:"Pretender", artist:"Officialé«­ç”·dism"},
  {title:"Lemon", artist:"ç±³æ´¥ç„å¸«"},
  {title:"ãƒãƒªãƒ¼ã‚´ãƒ¼ãƒ«ãƒ‰", artist:"ã‚ã„ã¿ã‚‡ã‚“"}
];

const canvas = document.getElementById('amida-stage');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const resultText = document.getElementById('result-text');

let lines = []; // æ¨ªç·šã®ãƒ‡ãƒ¼ã‚¿

function initTable() {
    const t = document.getElementById("songTable");
    t.innerHTML = "<tr><th>æ›²å</th><th>æ­Œæ‰‹</th></tr>";
    songs.forEach(s => t.innerHTML += `<tr><td>${s.title}</td><td>${s.artist}</td></tr>`);
}

function drawAmida() {
    startBtn.disabled = true;
    resultText.innerText = "";
    
    const count = songs.length;
    const spacing = canvas.width / (count + 1);
    const startY = 50;
    const endY = 350;
    
    // æ¨ªç·šã®ç”Ÿæˆ
    lines = [];
    for (let i = 0; i < count - 1; i++) {
        for (let j = 0; j < 4; j++) { // å„åˆ—ã«4æœ¬ç¨‹åº¦ã®æ¨ªç·š
            lines.push({
                from: i,
                y: startY + Math.random() * (endY - startY - 20) + 10
            });
        }
    }

    // æç”»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    let currentY = startY;
    let currentCol = Math.floor(Math.random() * count); // ã‚¹ã‚¿ãƒ¼ãƒˆä½ç½®ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«
    const startCol = currentCol;

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // ç¸¦ç·šã¨æ–‡å­—ã®æç”»
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.font = "12px sans-serif";
        ctx.fillStyle = "#333";

        for (let i = 0; i < count; i++) {
            const x = spacing * (i + 1);
            ctx.beginPath();
            ctx.moveTo(x, startY);
            ctx.lineTo(x, endY);
            ctx.stroke();
            
            // ä¸‹ã«æ›²åã‚’ç¸¦æ›¸ãã£ã½ãè¡¨ç¤º
            ctx.fillText(songs[i].title.substring(0,6), x - 10, endY + 20);
        }

        // æ¨ªç·šã®æç”»
        lines.forEach(line => {
            const x1 = spacing * (line.from + 1);
            const x2 = spacing * (line.from + 2);
            ctx.beginPath();
            ctx.moveTo(x1, line.y);
            ctx.lineTo(x2, line.y);
            ctx.stroke();
        });

        // è¿½è·¡ã‚«ãƒ¼ã‚½ãƒ«ã®æç”»ï¼ˆèµ¤ä¸¸ï¼‰
        moveLogic();
    }

    let traceY = startY;
    let traceCol = startCol;
    let visitedLines = new Set();

    function moveLogic() {
        ctx.fillStyle = 'red';
        ctx.beginPath();
        ctx.arc(spacing * (traceCol + 1), traceY, 6, 0, Math.PI * 2);
        ctx.fill();

        if (traceY < endY) {
            // æ¨ªç·šåˆ¤å®š
            let hitLine = lines.find(l => 
                Math.abs(l.y - traceY) < 2 && 
                (l.from === traceCol || l.from === traceCol - 1) &&
                !visitedLines.has(l)
            );

            if (hitLine) {
                visitedLines.add(hitLine);
                if (hitLine.from === traceCol) {
                    traceCol++; // å³ã¸
                } else {
                    traceCol--; // å·¦ã¸
                }
            }
            traceY += 2; // ä¸‹ã«é€²ã‚€
            requestAnimationFrame(animate);
        } else {
            // çµ‚äº†
            resultText.innerText = "âœ¨ çµæœï¼š " + songs[traceCol].title + " âœ¨";
            startBtn.disabled = false;
        }
    }
    animate();
}

initTable();
// åˆå›æç”»
setTimeout(drawAmida, 500);
</script>

</body>
</html>
