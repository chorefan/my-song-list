<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Song Portal</title>
<style>
  :root { --primary: #4CAF50; --accent: #e91e63; --bg: #f0f2f5; }
  body { font-family: sans-serif; line-height: 1.6; padding: 20px; max-width: 900px; margin: auto; background-color: var(--bg); color: #333; }
  section { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; }
  h1, h2 { border-bottom: 3px solid var(--primary); padding-bottom: 10px; }
  
  /* ãƒœã‚¿ãƒ³é¡ */
  .btn { border: none; padding: 12px 24px; border-radius: 30px; cursor: pointer; font-weight: bold; transition: 0.3s; font-size: 1rem; }
  .btn-main { background: var(--primary); color: white; }
  .btn-accent { background: var(--accent); color: white; }
  .btn-copy { background: #eee; color: #333; padding: 5px 15px; font-size: 0.8rem; border-radius: 5px; }
  .btn:hover { opacity: 0.8; transform: scale(1.05); }

  /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå°çª“ï¼‰ã®è¨­å®š */
  #amida-modal {
    display: none; /* æœ€åˆã¯éš ã™ */
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8); z-index: 1000;
    justify-content: center; align-items: center;
  }
  .modal-content {
    background: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 800px;
    position: relative; text-align: center;
  }
  .close-btn { position: absolute; top: 10px; right: 20px; font-size: 2rem; cursor: pointer; color: #666; }

  canvas { background: #fff; width: 100%; height: auto; border: 1px solid #eee; }
  
  .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
  input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border-bottom: 1px solid #eee; padding: 15px; text-align: left; }
</style>
</head>
<body>

<h1>ğŸ¤ My Song Portal</h1>

<section id="profile">
  <h2>Profile</h2>
  <p>æ­Œã†AIã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚ä»Šæ—¥ã®1æ›²ã‚’ã‚ã¿ã ãã˜ã§é¸ã‚“ã§ã¿ã¾ã›ã‚“ã‹ï¼Ÿ</p>
  <button class="btn btn-main" onclick="openAmida()">ğŸ² ã‚ã¿ã ãã˜ã§é¸æ›²ã™ã‚‹</button>
</section>

<div id="amida-modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeAmida()">&times;</span>
    <h3>é‹å‘½ã®ã‚ã¿ã ãã˜</h3>
    <canvas id="amida-stage" width="800" height="400"></canvas>
    
    <div id="result-area" style="margin-top: 15px; min-height: 80px;">
      <div id="result-text" style="font-size: 1.4rem; font-weight: bold; color: var(--accent);"></div>
      <div id="action-btns" style="display: none; gap: 10px; justify-content: center; margin-top: 10px;">
        <button class="btn btn-main" onclick="startAmida()">ã‚‚ã†ä¸€å›ï¼</button>
        <button id="copyBtn" class="btn btn-copy" onclick="copyResult()">æ›²åã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>
    </div>
  </div>
</div>

<section id="list">
  <h2>ğŸ” æ›²ãƒªã‚¹ãƒˆ</h2>
  <div class="search-box">
    <input id="songSearch" placeholder="æ›²åã§æ¤œç´¢..." oninput="filterList()">
  </div>
  <table id="songTable"></table>
</section>

<script>
const songs = [
  {title:"é’ã„çŠç‘šç¤", artist:"æ¾ç”°è–å­"},
  {title:"æ „å…‰ã®æ¶æ©‹", artist:"ã‚†ãš"},
  {title:"å¤œã«é§†ã‘ã‚‹", artist:"YOASOBI"},
  {title:"ä¸–ç•Œã«ä¸€ã¤ã ã‘ã®èŠ±", artist:"SMAP"},
  {title:"Pretender", artist:"Officialé«­ç”·dism"},
  {title:"Lemon", artist:"ç±³æ´¥ç„å¸«"}
];

const modal = document.getElementById('amida-modal');
const canvas = document.getElementById('amida-stage');
const ctx = canvas.getContext('2d');
const resultText = document.getElementById('result-text');
const actionBtns = document.getElementById('action-btns');

let amidaLines = [];
let currentResult = "";

// ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œ
function openAmida() {
  modal.style.display = 'flex';
  startAmida();
}

function closeAmida() {
  modal.style.display = 'none';
}

// ã‚ã¿ã ãã˜å®Ÿè¡Œ
function startAmida() {
  actionBtns.style.display = "none";
  resultText.innerText = "ç”Ÿæˆä¸­...";
  
  const count = songs.length;
  amidaLines = [];
  for (let i = 0; i < count - 1; i++) {
    for (let j = 0; j < 4; j++) {
      amidaLines.push({ from: i, y: 50 + Math.random() * 280 });
    }
  }
  animate();
}

function animate() {
  const count = songs.length;
  const spacing = canvas.width / (count + 1);
  const startY = 30, endY = 350;
  let traceY = startY;
  let traceCol = Math.floor(Math.random() * count);
  let visitedLines = new Set();

  function frame() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = '#ddd';
    for (let i = 0; i < count; i++) {
      const x = spacing * (i + 1);
      ctx.beginPath(); ctx.moveTo(x, startY); ctx.lineTo(x, endY); ctx.stroke();
      ctx.fillStyle = "#999"; ctx.font = "10px sans-serif";
      ctx.fillText(songs[i].title.substring(0,5), x - 15, endY + 20);
    }
    amidaLines.forEach(l => {
      ctx.beginPath(); ctx.moveTo(spacing*(l.from+1), l.y); ctx.lineTo(spacing*(l.from+2), l.y); ctx.stroke();
    });

    ctx.fillStyle = '#e91e63';
    ctx.beginPath(); ctx.arc(spacing * (traceCol + 1), traceY, 8, 0, Math.PI * 2); ctx.fill();

    if (traceY < endY) {
      let hit = amidaLines.find(l => Math.abs(l.y - traceY) < 2 && (l.from === traceCol || l.from === traceCol - 1) && !visitedLines.has(l));
      if (hit) { visitedLines.add(hit); traceCol = (hit.from === traceCol) ? traceCol + 1 : traceCol - 1; }
      traceY += 4;
      requestAnimationFrame(frame);
    } else {
      currentResult = `${songs[traceCol].title} / ${songs[traceCol].artist}`;
      resultText.innerHTML = `âœ¨ çµæœï¼š${currentResult} âœ¨`;
      actionBtns.style.display = "flex";
    }
  }
  frame();
}

// ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
function copyResult() {
  navigator.clipboard.writeText(currentResult).then(() => {
    const btn = document.getElementById('copyBtn');
    btn.innerText = "ã‚³ãƒ”ãƒ¼å®Œäº†ï¼";
    setTimeout(() => btn.innerText = "æ›²åã‚’ã‚³ãƒ”ãƒ¼", 2000);
  });
}

function filterList() {
  const q = document.getElementById("songSearch").value.toLowerCase();
  const filtered = songs.filter(s => s.title.toLowerCase().includes(q) || s.artist.toLowerCase().includes(q));
  const t = document.getElementById("songTable");
  t.innerHTML = "<tr><th>æ›²å / æ­Œæ‰‹</th><th>æ“ä½œ</th></tr>";
  filtered.forEach(s => {
    t.innerHTML += `<tr><td>${s.title} <br><small>${s.artist}</small></td>
    <td><button class="btn btn-copy" onclick="copyDirect('${s.title} / ${s.artist}')">ã‚³ãƒ”ãƒ¼</button></td></tr>`;
  });
}

function copyDirect(text) {
  navigator.clipboard.writeText(text);
  alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
}

filterList();
</script>
</body>
</html>
