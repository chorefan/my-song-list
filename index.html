<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Song Portal</title>
<style>
  /* ã‚¹ã‚¿ã‚¤ãƒ«ã¯ç¶­æŒ */
  body { font-family: sans-serif; line-height: 1.6; padding: 20px; max-width: 900px; margin: auto; background-color: #f0f2f5; }
  section { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px; }
  h1, h2 { border-bottom: 3px solid #4CAF50; padding-bottom: 10px; }
  .search-box { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
  input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; }
  #amida-stage { background: #fff; border: 1px solid #eee; width: 100%; height: auto; }
  .btn-start { background: #4CAF50; color: white; border: none; padding: 15px 30px; border-radius: 30px; cursor: pointer; font-weight: bold; font-size: 1.1rem; }
  .btn-start:disabled { background: #ccc; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #eee; padding: 12px; text-align: left; }
</style>
</head>
<body>

<h1>ğŸ¤ My Song Portal</h1>

<section id="profile">
  <h2>Profile</h2>
  <p><strong>åå‰ï¼š</strong> æ­Œã†AIã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼</p>
  <p>æ‡ãƒ¡ãƒ­ã‹ã‚‰æœ€æ–°æ›²ã¾ã§ã€‚ã‚ã¿ã ãã˜ã§ä»Šæ—¥ã®1æ›²ã‚’æ±ºã‚ã¾ã—ã‚‡ã†ï¼</p>
</section>

<section id="amida">
  <h2>ğŸ² ä»Šæ—¥ã®1æ›²ã‚ã¿ã ãã˜</h2>
  <canvas id="amida-stage" width="800" height="400"></canvas>
  <div style="margin-top:20px;">
    <button id="startBtn" class="btn-start" onclick="startAmidaProcess()">ã‚ã¿ã ãã˜ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
  </div>
  <div id="result-text" style="font-size: 1.5rem; font-weight: bold; color: #e91e63; margin-top: 15px; min-height: 1.5em;"></div>
</section>

<section id="list">
  <h2>ğŸ” æ›²æ¤œç´¢ãƒ»ãƒªã‚¹ãƒˆ</h2>
  <div class="search-box">
    <input id="songSearch" placeholder="æ›²åã§æ¤œç´¢..." oninput="filterList()">
    <input id="artistSearch" placeholder="æ­Œæ‰‹åã§æ¤œç´¢..." oninput="filterList()">
  </div>
  <table id="songTable"></table>
</section>

<script>
const songs = [
  {title:"é’ã„çŠç‘šç¤", artist:"æ¾ç”°è–å­"},
  {title:"æ „å…‰ã®æ¶æ©‹", artist:"ã‚†ãš"},
  {title:"å¤œã«é§†ã‘ã‚‹", artist:"YOASOBI"},
  {title:"ä¸–ç•Œã«ä¸€ã¤ã ã‘ã®èŠ±", artist:"SMAP"},
  {title:"Pretender", artist:"Officialé«­ç”·dism"},
  {title:"Lemon", artist:"ç±³æ´¥ç„å¸«"},
  {title:"ãƒãƒªãƒ¼ã‚´ãƒ¼ãƒ«ãƒ‰", artist:"ã‚ã„ã¿ã‚‡ã‚“"}
];

const canvas = document.getElementById('amida-stage');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const resultText = document.getElementById('result-text');

let isPlaying = false;
let amidaLines = []; // æ¨ªç·šãƒ‡ãƒ¼ã‚¿

// åˆæœŸè¡¨ç¤ºï¼ˆç¸¦ç·šã®ã¿æç”»ï¼‰
function initAmida() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const count = songs.length;
    const spacing = canvas.width / (count + 1);
    const startY = 30, endY = 350;

    ctx.strokeStyle = '#ddd';
    ctx.lineWidth = 2;
    for (let i = 0; i < count; i++) {
        const x = spacing * (i + 1);
        ctx.beginPath(); ctx.moveTo(x, startY); ctx.lineTo(x, endY); ctx.stroke();
        ctx.fillStyle = "#999"; ctx.font = "10px sans-serif";
        ctx.fillText(songs[i].title.substring(0,5), x - 15, endY + 20);
    }
}

// ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å®Ÿè¡Œ
function startAmidaProcess() {
    if (isPlaying) return;
    isPlaying = true;
    startBtn.disabled = true;
    resultText.innerText = "é‹å‘½ã®ç§»å‹•ä¸­...";

    // æ¨ªç·šã®ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
    const count = songs.length;
    amidaLines = [];
    for (let i = 0; i < count - 1; i++) {
        for (let j = 0; j < 3; j++) {
            amidaLines.push({ 
                from: i, 
                y: 50 + Math.random() * 280 
            });
        }
    }

    animateAmida();
}

function animateAmida() {
    const count = songs.length;
    const spacing = canvas.width / (count + 1);
    const startY = 30, endY = 350;
    let traceY = startY;
    let traceCol = Math.floor(Math.random() * count);
    let visitedLines = new Set();

    function frame() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 1. ç¸¦ç·šã¨æ›²å
        ctx.strokeStyle = '#ddd';
        for (let i = 0; i < count; i++) {
            const x = spacing * (i + 1);
            ctx.beginPath(); ctx.moveTo(x, startY); ctx.lineTo(x, endY); ctx.stroke();
            ctx.fillStyle = "#999";
            ctx.fillText(songs[i].title.substring(0,5), x - 15, endY + 20);
        }

        // 2. ç”Ÿæˆã•ã‚ŒãŸæ¨ªç·šã‚’æç”»
        ctx.strokeStyle = '#ddd';
        amidaLines.forEach(l => {
            ctx.beginPath();
            ctx.moveTo(spacing * (l.from + 1), l.y);
            ctx.lineTo(spacing * (l.from + 2), l.y);
            ctx.stroke();
        });

        // 3. å‹•ãèµ¤ã„ä¸¸
        ctx.fillStyle = '#e91e63';
        ctx.beginPath();
        ctx.arc(spacing * (traceCol + 1), traceY, 8, 0, Math.PI * 2);
        ctx.fill();

        // 4. ç§»å‹•ãƒ­ã‚¸ãƒƒã‚¯
        if (traceY < endY) {
            let hit = amidaLines.find(l => 
                Math.abs(l.y - traceY) < 2 && 
                (l.from === traceCol || l.from === traceCol - 1) && 
                !visitedLines.has(l)
            );
            
            if (hit) {
                visitedLines.add(hit);
                traceCol = (hit.from === traceCol) ? traceCol + 1 : traceCol - 1;
            }
            traceY += 3;
            requestAnimationFrame(frame);
        } else {
            resultText.innerText = "âœ¨ çµæœï¼š " + songs[traceCol].title + " âœ¨";
            startBtn.disabled = false;
            isPlaying = false;
        }
    }
    frame();
}

// æ¤œç´¢æ©Ÿèƒ½
function filterList() {
    const songQ = document.getElementById("songSearch").value.toLowerCase();
    const artistQ = document.getElementById("artistSearch").value.toLowerCase();
    const filtered = songs.filter(s => 
      s.title.toLowerCase().includes(songQ) && s.artist.toLowerCase().includes(artistQ)
    );
    const t = document.getElementById("songTable");
    t.innerHTML = "<tr><th>æ›²å</th><th>æ­Œæ‰‹</th></tr>";
    filtered.forEach(s => t.innerHTML += `<tr><td>${s.title}</td><td>${s.artist}</td></tr>`);
}

// åˆæœŸåŒ–
initAmida();
filterList();
</script>

</body>
</html>
